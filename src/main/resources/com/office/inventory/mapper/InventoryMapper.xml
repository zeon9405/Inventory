<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.office.inventory.mapper.InventoryMapper">

	<resultMap id="empMap" type="com.office.inventory.vo.EmpVO">
		<id property="emp_id" column="emp_id" />
		<result property="password" column="password" />
		<result property="name" column="name" />
		<result property="dept" column="dept" />
		<result property="role" column="role" />
	</resultMap>
	<resultMap id="itemMap" type="com.office.inventory.vo.ItemVO">
		<id property="item_id" column="item_id" />
		<result property="item_name" column="item_name" />
		<result property="cat_id" column="cat_id" />
		<result property="item_price" column="item_price" />
		<result property="status" column="status" />
		<result property="quantity" column="quantity" />
		<result property="reg_date" column="reg_date" />

		<association property="categoryVO"
			javaType="com.office.inventory.vo.CategoryVO">
			<id property="cat_id" column="cat_id" />
			<result property="cat_name" column="cat_name" />
		</association>
	</resultMap>

	<select id="getItemList" resultMap="itemMap">
		select i.*, c.cat_name
		from
		item i
		join item_category c ON c.cat_id = i.cat_id
		order by i.item_id
		desc
	</select>

	<insert id="insertRental">
		INSERT INTO rental
		(rental_id, emp_id, item_id,
		rent_date, ret_exp_date)
		VALUES
		(0, #{empVO.emp_id},
		#{item_id}, now(),
		now()+ 7)
	</insert>

	<update id="updateItemCnt">
		UPDATE item
		SET quantity = quantity - 1
		WHERE item_id =
		#{item_id}
	</update>

	<select id="loginCheck" resultType="Integer">
		SELECT COUNT(*) FROM emp
		where emp_id = #{emp_id} and password = #{password}
	</select>

	<select id="getMyRentalList"
		resultType="com.office.inventory.vo.RentalVO">
		SELECT
		r.rental_id, r.emp_id, r.item_id, r.rent_date,
		r.ret_exp_date, r.ret_act_date, i.item_name
		FROM rental r
		JOIN item i ON
		r.item_id = i.item_id
		WHERE r.emp_id = #{emp_id}
		AND r.ret_act_date IS
		NULL
		ORDER BY r.rent_date DESC
	</select>

	<update id="updateReturnDate">
		update rental
		set ret_act_date = now()
		where rental_id
		= #{rendtal_id}
	</update>

	<update id="increaseQuantity">
		update item
		set quantity = quantity + 1
		where item_id =
		#{item_id}
	</update>

	<insert id="insertNewItem">
		insert into item (item_name, cat_id, item_price,
		quantity)
		values(#{item_name}, #{cat_id}, #{item_price}, #{quantity})
	</insert>



	<!-- <select id="getAllItems" resultMap="itemMap"> SELECT i.*, c.cat_name 
		FROM item i JOIN item_category c ON i.cat_id = c.cat_id ORDER BY i.item_id 
		DESC </select> <update id="decreaseQuantity"> UPDATE item SET quantity = 
		quantity - 1 WHERE item_id = #{item_id} AND quantity > 0 </update> <insert 
		id="insertRental"> INSERT INTO rental (rental_id, emp_id, item_id, rent_date, 
		ret_exp_date) VALUES (0, 'user01', #{item_id}, now(), now()+ 7) </insert> 
		<update id="updateReturnDate"> UPDATE rental SET ret_act_date = now() WHERE 
		rental_id = #{rental_id} </update> <update id="increaseQuantity"> UPDATE 
		item SET quantity = quantity + 1 WHERE item_id = #{item_id} </update> -->
</mapper>